{"version":3,"sources":["../../src/plugins/lists.js"],"names":["UL","OL","LI","INCREASE_INDENT","DECREASE_INDENT","ListsPlugin","props","DEFAULT_NODE","plugin","types","typeItem","typeDefault","plugins","Plugin","createButton","type","icon","editorState","onChange","changes","wrapInList","unwrapList","increaseItemDepth","decreaseItemDepth","onClick","e","preventDefault","change","inList","utils","isSelectionInList","value","isType","blocks","some","document","getClosest","block","key","parent","isIncreaseDecrease","previousItem","getPreviousItem","currentItem","getCurrentItem","itemDepth","getItemDepth","canIncreaseIndent","canDecreaseIndent","increaseDecreaseDisabled","name","schema","nodes","toolbarButtons","deserialize","el","next","tagName","toLowerCase","object","childNodes","serialize","children","renderNode","attributes","node"],"mappings":"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","file":"lists.js","sourcesContent":["/*\r\n * This file is part of ORY Editor.\r\n *\r\n * ORY Editor is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * ORY Editor is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with ORY Editor.  If not, see <http://www.gnu.org/licenses/>.\r\n *\r\n * @license LGPL-3.0\r\n * @copyright 2016-2018 Aeneas Rekkas\r\n * @author Aeneas Rekkas <aeneas+oss@aeneas.io>\r\n *\r\n */\r\n\r\n/* eslint-disable prefer-reflect, default-case, react/display-name */\r\nimport React from 'react'\r\nimport ListIcon from '@material-ui/icons/List'\r\nimport OrderedListIcon from '@material-ui/icons/FormatListNumbered'\r\nimport IncreaseIndentIcon from '@material-ui/icons/FormatIndentIncrease'\r\nimport DecreaseIndentIcon from '@material-ui/icons/FormatIndentDecrease'\r\nimport type { Props } from './props'\r\nimport createListPlugin from 'slate-edit-list'\r\n\r\nimport { makeTagNode, ToolbarButton } from '../helpers'\r\nimport Plugin from './Plugin'\r\n\r\nexport const UL = 'LISTS/UNORDERED-LIST'\r\nexport const OL = 'LISTS/ORDERED-LIST'\r\nexport const LI = 'LISTS/LIST-ITEM'\r\n\r\nconst INCREASE_INDENT = 'INCREASE_INDENT'\r\nconst DECREASE_INDENT = 'DECREASE_INDENT'\r\n\r\nexport default class ListsPlugin extends Plugin {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.DEFAULT_NODE = props.DEFAULT_NODE;\r\n    this.plugin = createListPlugin({\r\n      types: [UL, OL],\r\n      typeItem: LI,\r\n      typeDefault: props.DEFAULT_NODE\r\n    })\r\n    this.plugins = [\r\n      this.plugin\r\n    ]\r\n  }\r\n\r\n  props: Props\r\n\r\n  // eslint-disable-next-line react/display-name\r\n  createButton = (type, icon) => ({ editorState, onChange }: Props) => {\r\n    const {\r\n      wrapInList,\r\n      unwrapList,\r\n      increaseItemDepth,\r\n      decreaseItemDepth\r\n    } = this.plugin.changes\r\n    const onClick = e => {\r\n      e.preventDefault()\r\n\r\n      let change = editorState.change()\r\n\r\n      if (type !== UL && type !== OL) {\r\n        if (type === INCREASE_INDENT) {\r\n          increaseItemDepth(change)\r\n        } else {\r\n          decreaseItemDepth(change)\r\n        }\r\n      } else {\r\n        const inList = this.plugin.utils.isSelectionInList(editorState);\r\n        if (inList) {\r\n          unwrapList(change, type)\r\n        } else {\r\n          wrapInList(change, type)\r\n        }\r\n      }\r\n\r\n      onChange({ value: change.value })\r\n    }\r\n\r\n    const inList = this.plugin.utils.isSelectionInList(editorState);\r\n    const isType = editorState.blocks.some(block =>\r\n      !!editorState.document.getClosest(\r\n        block.key,\r\n        parent => parent.type === type\r\n      )\r\n    )\r\n    const isIncreaseDecrease = type === INCREASE_INDENT || type === DECREASE_INDENT\r\n\r\n    const previousItem = this.plugin.utils.getPreviousItem(editorState);\r\n    const currentItem = this.plugin.utils.getCurrentItem(editorState);\r\n    const itemDepth = this.plugin.utils.getItemDepth(editorState);\r\n\r\n    const canIncreaseIndent = previousItem && currentItem && isIncreaseDecrease\r\n    const canDecreaseIndent = itemDepth > 1 && currentItem && isIncreaseDecrease\r\n\r\n    const increaseDecreaseDisabled = type === INCREASE_INDENT ? !canIncreaseIndent : !canDecreaseIndent\r\n\r\n    return (\r\n      <ToolbarButton\r\n        onClick={onClick}\r\n        isActive={inList && isType}\r\n        icon={icon}\r\n        disabled={isIncreaseDecrease && increaseDecreaseDisabled}\r\n      />\r\n    )\r\n  }\r\n\r\n  name = 'lists'\r\n\r\n  schema = {\r\n    nodes: {\r\n      [UL]: makeTagNode('ul'),\r\n      [OL]: makeTagNode('ol'),\r\n      [LI]: makeTagNode('li')\r\n    }\r\n  }\r\n\r\n  toolbarButtons = [\r\n    this.createButton(UL, <ListIcon />),\r\n    this.createButton(OL, <OrderedListIcon />),\r\n    this.createButton(INCREASE_INDENT, <IncreaseIndentIcon />),\r\n    this.createButton(DECREASE_INDENT, <DecreaseIndentIcon />),\r\n  ]\r\n\r\n  deserialize = (el, next) => {\r\n    switch (el.tagName.toLowerCase()) {\r\n      case 'ul':\r\n        return {\r\n          object: 'block',\r\n          type: UL,\r\n          nodes: next(el.childNodes)\r\n        }\r\n      case 'li':\r\n        return {\r\n          object: 'block',\r\n          type: LI,\r\n          nodes: next(el.childNodes)\r\n        }\r\n      case 'ol':\r\n        return {\r\n          object: 'block',\r\n          type: OL,\r\n          nodes: next(el.childNodes)\r\n        }\r\n    }\r\n  }\r\n\r\n  serialize = (object: { type: string, object: string }, children: any[]) => {\r\n    if (object.object !== 'block') {\r\n      return\r\n    }\r\n    switch (object.type) {\r\n      case UL:\r\n        return <ul>{children}</ul>\r\n      case LI:\r\n        return <li>{children}</li>\r\n      case OL:\r\n        return <ol>{children}</ol>\r\n    }\r\n  }\r\n\r\n  renderNode = props => {\r\n    const { children, attributes } = props;\r\n    switch (props.node.type) {\r\n      case UL:\r\n        return <ul {...attributes}>{children}</ul>\r\n      case LI:\r\n        return <li {...attributes}>{children}</li>\r\n      case OL:\r\n        return <ol {...attributes}>{children}</ol>\r\n    }\r\n  }\r\n}\r\n"]}
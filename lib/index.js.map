{"version":3,"sources":["../src/index.js"],"names":["hooks","createPlugins","flatten","createInitialState","html","Html","rules","defaultPlugins","lineBreakSerializer","parseHtml","parse5","parseFragment","plugins","props","concat","onKeyDown","e","data","state","isMod","key","isShift","change","insertText","value","i","length","newState","HoverButtons","editorState","onChange","focus","map","plugin","hoverButtons","Button","j","ToolbarButtons","toolbarButtons","Slate","cellProps","StaticComponent","__html","serialize","Component","name","version","IconComponent","text","description","allowInlineNeighbours","handleFocus","source","isFocused","setTimeout","handleBlur","blur","reducer","action","type","ActionTypes","UNDO","REDO","content","merge","isNative","handleRemoveHotKey","handleFocusPreviousHotKey","handleFocusNextHotKey","unserialize","migrations","v002"],"mappings":"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","file":"index.js","sourcesContent":["/*\r\n * This file is part of ORY Editor.\r\n *\r\n * ORY Editor is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Lesser General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * ORY Editor is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Lesser General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Lesser General Public License\r\n * along with ORY Editor.  If not, see <http://www.gnu.org/licenses/>.\r\n *\r\n * @license LGPL-3.0\r\n * @copyright 2016-2018 Aeneas Rekkas\r\n * @author Aeneas Rekkas <aeneas+oss@aeneas.io>\r\n *\r\n */\r\n\r\n// @flow\r\n// TODO lint: prefer-reflect doesn't work with slate state #158\r\n/* eslint no-duplicate-imports: [\"off\"] */\r\n/* eslint prefer-reflect: [\"off\"] */\r\nimport Subject from '@material-ui/icons/Subject'\r\nimport { compose, flatten, map, prop, pathOr } from 'ramda'\r\nimport Html from 'slate-html-serializer'\r\nimport React from 'react'\r\nimport { ActionTypes } from 'redux-undo'\r\nimport Component from './Component'\r\nimport type { Props } from './Component'\r\nimport Plugin from './plugins/Plugin'\r\n// import KatexPlugin from './plugins/katex'\r\nimport * as hooks from './hooks'\r\nimport parse5 from 'parse5'\r\nimport v002 from './migrations/v002'\r\n\r\nconst createPlugins = compose(flatten, map(prop('plugins')))\r\n\r\nexport const createInitialState = hooks.createInitialState\r\n\r\nexport const html = new Html({\r\n  rules: [...hooks.defaultPlugins, hooks.lineBreakSerializer],\r\n  parseHtml: parse5.parseFragment\r\n})\r\n\r\nexport const defaultPlugins = hooks.defaultPlugins\r\n\r\nexport default (plugins: Plugin[] = hooks.defaultPlugins) => {\r\n  const props = {}\r\n  props.plugins = (plugins ? plugins : []).concat(createPlugins(plugins))\r\n  props.onKeyDown = (\r\n    e: Event,\r\n    data: { key: string, isMod: boolean, isShift: boolean },\r\n    state: any\r\n  ) => {\r\n    // we need to prevent slate from handling undo and redo\r\n    if (data.isMod && (data.key === 'z' || data.key === 'y')) {\r\n      return state\r\n    }\r\n\r\n    if (data.isShift && data.key === 'enter') {\r\n      return state\r\n        .change()\r\n        .insertText('\\n')\r\n        .value\r\n    }\r\n\r\n    for (let i = 0; i < plugins.length; i++) {\r\n      const { onKeyDown } = plugins[i]\r\n      const newState = onKeyDown && onKeyDown(e, data, state)\r\n\r\n      if (newState) {\r\n        return newState\r\n      }\r\n    }\r\n\r\n    return\r\n  }\r\n\r\n  const HoverButtons = ({ editorState, onChange, focus }: Props) => (\r\n    <div>\r\n      {plugins.map((plugin: Plugin, i: number) =>\r\n        plugin.hoverButtons.map((Button: any, j: number) => (\r\n          <Button\r\n            key={`${i}-${j}`}\r\n            editorState={editorState}\r\n            onChange={onChange}\r\n            focus={focus}\r\n          />\r\n        ))\r\n      )}\r\n    </div>\r\n  )\r\n  props.HoverButtons = HoverButtons\r\n\r\n  const ToolbarButtons = ({ editorState, onChange, focus }: Props) => (\r\n    <div>\r\n      {plugins.map((plugin: Plugin, i: number) =>\r\n        plugin.toolbarButtons.map((Button: any, j: number) => (\r\n          <Button\r\n            key={`${i}-${j}`}\r\n            editorState={editorState}\r\n            onChange={onChange}\r\n            focus={focus}\r\n          />\r\n        ))\r\n      )}\r\n    </div>\r\n  )\r\n  props.ToolbarButtons = ToolbarButtons\r\n\r\n  const Slate = (cellProps: Props) => <Component {...cellProps} {...props} />\r\n  const StaticComponent = ({ state: { editorState } = {} }: Props) => (\r\n    <div\r\n      className=\"ory-plugins-content-slate-container\"\r\n      dangerouslySetInnerHTML={{ __html: html.serialize(editorState) }}\r\n    />\r\n  )\r\n  return {\r\n    Component: Slate,\r\n    StaticComponent,\r\n\r\n    name: 'ory/editor/core/content/slate',\r\n    version: '0.0.2',\r\n    IconComponent: <Subject />,\r\n    text: 'Text',\r\n    description: 'An advanced rich text area.',\r\n\r\n    allowInlineNeighbours: true,\r\n\r\n    handleFocus: (props: Props, source: string) => {\r\n      if (source === 'onMouseDown') {\r\n        return\r\n      } else if (props.state.editorState.isFocused) {\r\n        return\r\n      }\r\n\r\n      setTimeout(() => {\r\n        props.state.editorState\r\n          .change()\r\n          .focus()\r\n      }, 0)\r\n    },\r\n\r\n    handleBlur: (props: Props) => {\r\n      if (!props.state.editorState.isFocused) {\r\n        return\r\n      }\r\n\r\n      props.onChange({\r\n        editorState: props.state.editorState\r\n          .change()\r\n          .blur().value\r\n      })\r\n    },\r\n\r\n    reducer: (state: any, action: any) => {\r\n      if (\r\n        (action.type === ActionTypes.UNDO ||\r\n          action.type === ActionTypes.REDO) &&\r\n        pathOr(false, ['content', 'state', 'editorState'], state)\r\n      ) {\r\n        return {\r\n          ...state,\r\n          content: {\r\n            ...state.content,\r\n            state: {\r\n              ...state.content.state,\r\n              editorState: state.content.state.editorState.merge({\r\n                isNative: false\r\n              })\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return state\r\n    },\r\n\r\n    handleRemoveHotKey: hooks.handleRemoveHotKey,\r\n    handleFocusPreviousHotKey: hooks.handleFocusPreviousHotKey,\r\n    handleFocusNextHotKey: hooks.handleFocusNextHotKey,\r\n\r\n    createInitialState: hooks.createInitialState,\r\n    serialize: hooks.serialize,\r\n    unserialize: hooks.unserialize,\r\n\r\n    // TODO this is disabled because of #207\r\n    // merge = hooks.merge\r\n    // split = hooks.split\r\n\r\n    migrations: [v002]\r\n  }\r\n}\r\n"]}